<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">

        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css"> 
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.2.1/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.js"></script>
    </head>
    <body>
        <table id="example" class="display"></table>
        <div id = "chart" class="display"></div>
        <div id="chart1" class="display"></div>
        <table id="test" class="display"></table>

        <script>

        var chartData;
        var barChartData;
        var titles=["Departments", "Members"]; 
        $.ajax({
            dataType: "json",
            url: 'data.json',
            success: function(d){
                chartData = d;
                x = prepareTableData(d);
                createTable(x,d);
                createChart(d);
            }
        });

        $.ajax({
                dataType: "json",
                url: 'incoming_data_barchart_jorts.json',
                success: function(d){
                    barChartData = d;
                    x = prepareTableData2(d);
                    createChart2(d);
                    createTable2(x,d);
                }
            });

        function prepareTableData2(chartData){
            var dataSet = []
            for(var i =0; i < barChartData.departments.length; i++){
                dataSet.push(barChartData.departments[i].split());

                dataSet[i].push(barChartData.members[i]);
            }
            console.log(dataSet[0])
            return dataSet;
        }


        function prepareTableData(chartData){
            var dataSet = []
            for(var i =0; i < chartData.monthly.dates.length; i++){
                dataSet.push(chartData.monthly.dates[i].split());

                dataSet[i].push(chartData.monthly.users[i]);
            }
            console.log(dataSet[0])
            return dataSet;
        }


        function createTable(tableData, chartData){
        $(document).ready(function() {
                $('#example').DataTable( {
                    data: tableData,
                    columns: [
                        { title: "Date" },
                        { title: "Value" },
                    ],
                    "scrollY": "500px",
                    "paging": false,
                    scrollCollapse: true
                } );
            } );
        }

        function createTable2(tableData, chartData){
            $(document).ready(function() {
                $('#test').DataTable( {
                data: tableData,
                columns: [
                { title: titles[0] },
                { title: titles[1] },
                ],
                "scrollY": "500px",
                "paging": false,
                scrollCollapse: true
                } );
            } );
        }



        function createChart(chartData){
        chartData.daily.dates.unshift('x');
        columnss = chartData.daily.dates;
        chartData.daily.users.unshift('users');
        dataa = chartData.daily.users;
        var chart = c3.generate({
            bindto: '#chart',
            data: {
                x: 'x',
                xFormat: '%Y%m%d', // 'xFormat' can be used as custom format of 'x'
                columns: [
                    columnss,
                    dataa,
                ]
            },
            axis: {
                x: {
                    type: 'timeseries',
                    tick: {
                        format: '%Y-%m-%d'
                    }
                }
            }
        });

        }

        function createChart2(barChartData){
                columnss = barChartData.departments;
                barChartData.members.unshift('members');
                dataa = barChartData.members;
                var chart = c3.generate({
                    bindto: '#chart1',
                    data: {
                        columns: [
                        dataa,
                        ],
                        type: 'bar'
                    },
                    bar: {
                        width: {
                            ratio: 0.5 // this makes bar width 50% of length between ticks
                        }
                        // or
                        //width: 100 // this makes bar width 100px
                    },
                    axis: {
                        x: {
                        type: 'category',
                        categories: columnss
                    }
                }
                });
            }
        </script>
    </body>
</html>